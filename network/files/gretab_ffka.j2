{% set fqdn_ip = salt['grains.get']('fqdn_ip4') -%}
{% set gretab_dev = salt['network.ifacestartswith']('213.239.204.86') -%}
{% for gre in salt['pillar.get']('network:gre_ffka:tunnel') %}
{% if gre.mesh | to_bool %}
auto ftun-{{ gre.name }}
iface ftun-{{ gre.name }} inet manual
    pre-up ip link add $IFACE type gretap local {{ grains.fqdn_ip4[0]}} remote {{ gre.gre_target }} ttl 64 dev enp3s0 key 111
    post-up ip link set dev $IFACE up
    post-up batctl -m bat0 if add $IFACE
    post-down ip link del $IFACE
{% endif %}
{% endfor %}

{% for gre in salt['pillar.get']('network:gretab_ffka_special:tunnel') %}
auto ftun-{{ gre.name }}
iface ftun-{{ gre.name }} inet manual
    pre-up ip link add $IFACE type gretap local {{ grains.fqdn_ip4[0]}} remote {{ gre.gre_target }} ttl 64 dev enp3s0 key 111
    post-up ip link set dev $IFACE up
    post-up batctl -m bat0 if add $IFACE
    post-down ip link del $IFACE
{% endfor %}

#{{gretab_dev}}
#{{fqdn_ip}}
