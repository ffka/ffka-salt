{% set lo_vzffnrmo_v4 = salt['pillar.get']('network:lo:ipv4:vzffnrmo') -%}
{% set lo_vzffnrmo_v6 = salt['pillar.get']('network:lo:ipv6:vzffnrmo') -%}
{% set local_metro_community = salt['pillar.get']('routing:metro_community') -%}
{% set metro_aggregate = salt['pillar.get']('rrouting:v6_metroaggregate'') -%}
{% set aggregate = salt['pillar.get']('routing:v6_aggregate') -%}
define LOCAL_METRO = ({{ local_metro_community }});
define ROUTER_ID = {{ lo_vzffnrmo_v4 }};
define IBGP_SOURCE = {{ lo_vzffnrmo_v6 }};
define DRAINED = 0;
define METROIZED = 0;

router id {{ lo_vzffnrmo_v4 }};

protocol static {
	route {{ aggregate }} unreachable;
	route {{ metro_aggregate }} unreachable;
}

function originate_aggregate_route()
{
        if net ~ [ {{ aggregate }} ] then {
                return 1;
        }
        return 0;
}

function originate_metro_route()
{
        if net ~ [ {{ metro_aggregate }} ] then {
                return 1;
        }
        return 0;
}

log syslog all;
graceful restart wait 300;

protocol kernel {
	scan time 10;
	import all;
	export filter {
		krt_prefsrc = {{ lo_vzffnrmo_v6 }};
		accept;
	};
}

protocol static {
	route ::/0 unreachable;
}

protocol device {
	scan time 10;
}

protocol direct {
        interface "*";
}
